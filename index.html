<html>

<head>
    <title>bilo</title>

    <script src="./firebase/firebase-app.js"></script>
    <script src="./firebase/firebase-auth.js"></script>
    <script src="./firebase/firebase-firestore.js"></script>

    <script src="./babylon/earcut.js"></script>
    <script src="./babylon/babylon.js"></script>
    <script src="./babylon/pep.js"></script>

    <script src="./camera.js"></script>
    <script src="./sound.js"></script>

    <script src="./meshes.js"></script>

    <script src="./mesh.js"></script>
    <script src="./block.js"></script>
    <script src="./gui.js"></script>

    <script src="./settings.js"></script>

    <script src="./ble.js"></script>
    <script src="./database.js"></script>
    

  <!--   <script src="./compass.js"></script>-->
    


    <!--   <script src="./material.js"></script>-->


    <script src="./world.js"></script>
    <!--<script src="./screen.js"></script>-->
    <script src="./game.js"></script>
    <script src="./game/compassCalibration.js"></script>

    <!-- games -->
    <script src="./game/guidedBuild.js"></script>
    <script src="./game/guidedBuildLevel.js"></script>

    <script src="./game/freeBuild.js"></script>

    <script src="./game/tangram.js"></script>
    <script src="./game/tangramLevel.js"></script>

    <script src="./game/algebra.js"></script>



    <style>
        html,
        body,
        can {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            overflow: hidden;
            -webkit-user-select: none;

        }

        .text {
            cursor: zoom-in;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;

        }
    </style>


</head>

<body ondragstart="return false;" ondrop="return false;" oncontextmenu="return false;">
    <canvas id="renderCanvas" touch-action="none"></canvas>

    <script>




        /*
        
                ^
                X
                |
        <Z------0
        //front
        

        Rotation clockwise


        2x2 r0 x0 z0

                ^
                X
                |
              B B
        <Z----B-0


        2x4 r0 x0 z0

                ^
                X
                |
              B B
              B B
              B B
        <Z----B-0


        */


 


        var canvas = document.getElementById("renderCanvas");
        var engine = new BABYLON.Engine(canvas, true);//, {}, true);

        if (engine.getGlInfo().renderer == "Adreno (TM) 308") {
            engine.getCaps().highPrecisionShaderSupported = false;
        }


        let scene = new BABYLON.Scene(engine);
        scene.clearColor = new BABYLON.Color3(0.7, 0.8, 0.9);
        engine.displayLoadingUI();


        camera.init();
        sound.init();
        Mesh.init();

        MeshBase.init();
        MeshPixel.init(meshesPixel());

        Mesh2x2.init(meshes2x2());
        Mesh2x4.init(meshes2x4());
        Mesh2x2Trans.init(meshes2x2Full());
        Mesh2x4Trans.init(meshes2x4Full());

        MeshStar.init(meshesStar());

        MeshShadow.init();
        MeshShadowLeft.init(meshesShadowLeft());
        MeshShadowRight.init(meshesShadowRight());
        MeshShadowBack.init(meshesShadowBack());
        MeshShadowFront.init(meshesShadowFront());
        MeshShadowBottom.init(meshesShadowBottom());

        MeshNumber.init(meshesNumber());
        MeshNumberPillar.init(meshesNumberPillar());
    //    MeshOperator.init(meshesOperator());
        //let mx = meshesNumber();
   //     console.log ("PPP: " + mx);
      //  console.log ("PPP: " + mx.mesh.length);

        Gui.init();
        GuiButton.init();
        GuiButtonPaint.init();

        Block.init();
        Game.init();

        world.init(meshesBase());

        settings.init();
        ble.init();

        database.init({enabled: true}); //first create your own firebase account and configure database.js before enabling the database (still need to call database.init)
      

      
       //  compass.init();

     

        //--

        let colorWheel = new GuiColorWheel();

        window.onload = function () {
            engine.hideLoadingUI();
/*

            let x = BlockPillar.convertBlock([new Block2x4({ x : 0, y : 0, z : 8, r : 0, color : [0,0,0,0]}),new Block2x4({ x : 0, y : 0, z : 6, r : 0, color : [0,0,0,0]}),new Block2x4({ x : 4, y : 0, z : 9, r : 1, color : [0,0,0,0]}),new Block2x2({ x : 8, y : 0, z : 8, r : 0, color : [0,0]}),new Block2x2({ x : 9, y : 0, z : 7, r : 2, color : [0,0]}),new Block2x4({ x : 7, y : 0, z : 6, r : 3, color : [0,0,0,0]}),new Block2x4({ x : 0, y : 0, z : 4, r : 0, color : [0,0,0,0]}),new Block2x4({ x : 4, y : 0, z : 5, r : 1, color : [0,0,0,0]}),new Block2x2({ x : 8, y : 0, z : 5, r : 1, color : [0,0]}),new Block2x4({ x : 6, y : 0, z : 5, r : 1, color : [0,0,0,0]}),new Block2x4({ x : 0, y : 0, z : 2, r : 0, color : [0,0,0,0]}),new Block2x2({ x : 3, y : 0, z : 1, r : 2, color : [0,0]}),new Block2x2({ x : 1, y : 0, z : 0, r : 3, color : [0,0]}),new Block2x2({ x : 5, y : 0, z : 0, r : 3, color : [0,0]}),new Block2x2({ x : 8, y : 0, z : 3, r : 1, color : [0,0]}),new Block2x2({ x : 8, y : 0, z : 1, r : 1, color : [0,0]}),new Block2x2({ x : 7, y : 0, z : 1, r : 2, color : [0,0]}),]);

            console.log("x.lenght: " + x.length)

            x.forEach(function (item) {
                new MeshNumberPillar(item)
            });*/

           /* let b = new BlockNumber({ x: 0, y: 0, z: 0, color: [0]});

            let x = new MeshNumberLeft(b, 0);*/


  

          /*  meshesShadowLeft();

            let z = new GuiInput("erik.alexandersson@gmail.com");
            z.setVisible(0,0 , guiOptions.center, guiOptions.center);*/

          /*  let f = new Block2x2({ x : 4, y : 0, z : 7, r : 0, color : [1,0]});
           // let x = new Mesh2x2(f);
            let p = BlockPixel.convertBlock(f);
            new MeshPixel(p[0]);
            new MeshPixel(p[1]);
            new MeshPixel(p[2]);
            new MeshPixel(p[3]);*/
                // let sta = new MeshStar({height : world.maxHeight+1.5});
           // meshesStar();
           //let s = new MeshStar({height : 1.5});
/*
           s.dispose();
            s = null;

             s = new MeshStar({height : 2});*/
              /* let b = new Block2x2({ x: 0, y: 0, z: 0, r: 0 });
             let xxx = new MeshShadowBottom(b);*/
                         
        };


        window.addEventListener('DOMContentLoaded', function () {
            scene.onPointerDown = function (evt, pickResult) {
              //  console.log("mx.mesh.length: "+ mx.mesh.length);
               // console.log("mx.mesh[0].length: "+ mx.mesh[0].length);

                


                if (Gui.pointerDown(evt)) {

                } else if (pickResult.hit) {



                   colorWheel.pointerDown(evt, pickResult.pickedMesh.name)
   

                } else {
                    camera.pointerDown();
                }

            };




            engine.runRenderLoop(function () {
              //  console.log("mx.mesh.length: "+ mx.mesh.length);
                scene.render();
            });
            window.addEventListener("resize", function () {
                engine.resize();
                Gui.resize();
            });
        });


    </script>
</body>

</html>