<html>

<head>
    <title>bilo</title>

    <script src="./firebase/firebase-app.js"></script>
    <script src="./firebase/firebase-auth.js"></script>
    <script src="./firebase/firebase-firestore.js"></script>

    <script src="./babylon/earcut.js"></script>
    <script src="./babylon/babylon.js"></script>
    <script src="./babylon/pep.js"></script>

    <script src="./camera.js"></script>
    <script src="./sound.js"></script>

    <script src="./meshes.js"></script>

    <script src="./mesh.js"></script>
    <script src="./block.js"></script>
    <script src="./gui.js"></script>

    <script src="./settings.js"></script>

    <script src="./ble.js"></script>
    <script src="./database.js"></script>

    <script src="./world.js"></script>
    <script src="./game.js"></script>
    <script src="./game/compassCalibration.js"></script>

    <!-- games -->
    <script src="./game/guidedBuild.js"></script>
    <script src="./game/guidedBuildLevel.js"></script>

    <script src="./game/freeBuild.js"></script>

    <script src="./game/tangram.js"></script>
    <script src="./game/tangramLevel.js"></script>

    <script src="./game/tangram2D.js"></script>
    <script src="./game/tangram2DLevel.js"></script>

    <script src="./game/algebra.js"></script>

    <script src="./game/shapeHunter.js"></script>
    <script src="./game/shapeHunterLevel.js"></script>

    <script src="./game/memo.js"></script>
    <script src="./game/colorMatch.js"></script>

    <script src="./game/whack.js"></script>
    <script src="./game/columns.js"></script>



    <style>
        html,
        body,
        can {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            overflow: hidden;
            -webkit-user-select: none;
        }

        .text {
            cursor: zoom-in;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>


</head>

<body ondragstart="return false;" ondrop="return false;" oncontextmenu="return false;">
    <canvas id="renderCanvas" touch-action="none"></canvas>

    <script>


        /*
        
        Base coordinates
        -Power switch side
                ^
                X
                |
        <Z------0
        -Front side
        

        Block coordinates 
        Rotation clockwise

        2x2 r0 x0 z0

                ^
                X
                |
              B B
        <Z----B-0

        2x4 r0 x0 z0

                ^
                X
                |
              B B
              B B
              B B
        <Z----B-0

        */



        var canvas = document.getElementById("renderCanvas");
        var engine = new BABYLON.Engine(canvas, true);//, {}, true);

        if (engine.getGlInfo().renderer == "Adreno (TM) 308") {
            engine.getCaps().highPrecisionShaderSupported = false;
        }


        let scene = new BABYLON.Scene(engine);
        scene.clearColor = new BABYLON.Color3(0.7, 0.8, 0.9);
        engine.displayLoadingUI();


        camera.init();
        sound.init();
        Mesh.init();

        MeshBase.init();
        MeshPixel.init(meshesPixel());

        Mesh2x2.init(meshes2x2());
        Mesh2x4.init(meshes2x4());
        Mesh2x2Trans.init(meshes2x2Full());
        Mesh2x4Trans.init(meshes2x4Full());

        MeshStar.init(meshesStar());

        MeshShadow.init();
        MeshShadowLeft.init(meshesShadowLeft());
        MeshShadowRight.init(meshesShadowRight());
        MeshShadowBack.init(meshesShadowBack());
        MeshShadowFront.init(meshesShadowFront());
        MeshShadowBottom.init(meshesShadowBottom());

        MeshNumber.init(meshesNumber());
        MeshNumberPillar.init(meshesNumberPillar());
        MeshPad.init(meshesPad());

        Gui.init();
        GuiButton.init();
        GuiButtonPaint.init();

        Block.init();
        Game.init();

        world.init(meshesBase());

        world.base.ledFront = meshColor.black;
        world.base.ledLeft = meshColor.magenta;
        world.base.ledRight = meshColor.cyan;
        world.base.ledBack = meshColor.black;

        settings.init();
        ble.init();

        database.init({ enabled: true }); //first create your own firebase account and configure database.js before enabling the database (still need to call database.init)

        let colorWheel = new GuiColorWheel();

        window.onload = function () {
            engine.hideLoadingUI();
        };


        let timeOutResizeDeBounce = null;//iOS, bad behaviour
        let timeOutResizeDeBounceFunction = function (){
            let timeOutResizeDeBounce = null;
            engine.resize();
            Gui.resize();
        }


        window.addEventListener('DOMContentLoaded', function () {
            scene.onPointerDown = function (evt, pickResult) {

                if (Gui.pointerDown(evt)) {

                } else if (pickResult.hit) {

                    colorWheel.pointerDown(evt, pickResult.pickedMesh.name)

                } else {
                    camera.pointerDown();
                }

            };



            engine.runRenderLoop(function () {
                scene.render();
            });
            window.addEventListener("resize", function () {
                clearTimeout(timeOutResizeDeBounce);                  
                timeOutResizeDeBounce = setTimeout(timeOutResizeDeBounceFunction, 500);                        
            });
        });


    </script>
</body>

</html>